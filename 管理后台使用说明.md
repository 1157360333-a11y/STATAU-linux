# STATAU 管理后台使用说明

## 🛡️ 功能概述

STATAU 管理后台是一个功能完善的用户管理系统,管理员可以通过后台查看和管理所有用户信息,包括用户的注册信息、状态管理等操作。

---

## 🚀 快速开始

### 1. 初始化管理员账户

首次使用前,需要运行初始化脚本创建管理员账户:

```bash
python init_admin.py
```

**输出示例:**
```
======================================================================
STATAU 管理员账户初始化
======================================================================

[INFO] 正在创建管理员账户...
[SUCCESS] 管理员账户创建成功

======================================================================
管理员账户信息
======================================================================
用户名: admin
密码:   Qbt030523...
邮箱:   admin@statau.com
角色:   管理员
======================================================================

[提示] 请访问 http://localhost:5000/admin 登录管理后台
[提示] 建议登录后立即修改密码
======================================================================
```

### 2. 登录管理后台

1. 启动应用: `python app.py`
2. 访问首页: `http://localhost:5000`
3. 使用管理员账户登录:
   - 用户名: `admin`
   - 密码: `Qbt030523...`
4. 登录后,导航栏会显示金色的"管理后台"入口
5. 点击进入管理后台

---

## 📊 管理后台功能

### 1. 统计信息面板

管理后台首页显示四个统计卡片:

- **总用户数**: 系统中所有用户的数量
- **活跃用户**: 状态为"启用"的用户数量
- **已验证邮箱**: 完成邮箱验证的用户数量
- **管理员**: 管理员账户数量

### 2. 用户列表

用户列表以表格形式展示所有用户信息:

| 字段 | 说明 |
|------|------|
| ID | 用户唯一标识 |
| 用户名 | 用户登录名 |
| 邮箱 | 用户邮箱地址 |
| 角色 | 用户角色（管理员/普通用户） |
| 状态 | 账户状态（启用/禁用） |
| 邮箱验证 | 邮箱是否已验证 |
| 注册时间 | 用户注册时间 |
| 操作 | 管理操作按钮 |

### 3. 搜索功能

- 支持按用户名或邮箱搜索
- 实时搜索,输入关键词后点击"搜索"按钮
- 支持模糊匹配

### 4. 分页功能

- 每页显示 20 条记录
- 支持上一页/下一页翻页
- 显示当前页码和总页数

### 5. 用户管理操作

#### 启用/禁用用户

- 点击"启用"或"禁用"按钮切换用户状态
- 禁用后用户无法登录系统
- 不能禁用自己的账户
- 不能禁用其他管理员账户

#### 删除用户

- 点击"删除"按钮删除用户
- 需要二次确认
- 删除操作不可恢复
- 不能删除自己的账户
- 不能删除其他管理员账户

---

## 🔒 安全机制

### 1. 权限验证

- 所有管理后台接口都需要管理员权限
- 使用 `@admin_required` 装饰器验证权限
- 非管理员访问返回 403 错误

### 2. 操作限制

- **不能删除自己**: 防止管理员误删自己的账户
- **不能删除其他管理员**: 保护管理员账户安全
- **不能禁用自己**: 防止管理员误禁用自己
- **不能禁用其他管理员**: 保护管理员账户可用性

### 3. 密码安全

- 管理员密码使用 werkzeug 安全哈希存储
- 建议首次登录后立即修改密码
- 密码长度至少 6 位

---

## 🔧 API 接口文档

### 1. 获取统计信息

**URL**: `GET /admin/stats`

**权限**: 管理员

**响应**:
```json
{
    "total_users": 10,
    "active_users": 8,
    "verified_users": 6,
    "admin_users": 1
}
```

### 2. 获取用户列表

**URL**: `GET /admin/users`

**权限**: 管理员

**查询参数**:
- `page`: 页码（默认 1）
- `per_page`: 每页数量（默认 20）
- `search`: 搜索关键词

**响应**:
```json
{
    "users": [
        {
            "id": 1,
            "username": "user1",
            "email": "user1@example.com",
            "role": "user",
            "is_active": true,
            "email_verified": true,
            "created_at": "2024-01-20 10:00:00"
        }
    ],
    "total": 10,
    "page": 1,
    "per_page": 20,
    "pages": 1
}
```

### 3. 删除用户

**URL**: `POST /admin/users/delete`

**权限**: 管理员

**请求体**:
```json
{
    "user_id": 2
}
```

**响应**:
```json
{
    "status": "success",
    "message": "用户 user1 已删除"
}
```

### 4. 切换用户状态

**URL**: `POST /admin/users/toggle`

**权限**: 管理员

**请求体**:
```json
{
    "user_id": 2
}
```

**响应**:
```json
{
    "status": "success",
    "message": "用户 user1 已禁用",
    "is_active": false
}
```

---

## 📁 相关文件

- [`blueprints/admin.py`](blueprints/admin.py:1) - 管理后台蓝图（API 接口）
- [`templates/admin.html`](templates/admin.html:1) - 管理后台前端页面
- [`init_admin.py`](init_admin.py:1) - 管理员初始化脚本
- [`core/auth.py`](core/auth.py:1) - 用户模型（包含 role 字段）

---

## 🎨 界面特点

### 1. 现代化设计

- 渐变色卡片设计
- 悬停动画效果
- 响应式布局

### 2. 直观的状态标识

- **角色徽章**: 
  - 🟡 金色 - 管理员
  - 🔵 蓝色 - 普通用户
- **状态徽章**:
  - 🟢 绿色 - 启用
  - 🔴 红色 - 禁用
- **验证徽章**:
  - 🔵 蓝色 - 已验证
  - ⚪ 灰色 - 未验证

### 3. 操作按钮

- 🟡 黄色 - 启用/禁用
- 🔴 红色 - 删除

---

## ⚠️ 注意事项

### 1. 管理员账户

- 默认管理员用户名: `admin`
- 默认密码: `Qbt030523...`
- **强烈建议首次登录后立即修改密码**

### 2. 数据安全

- 删除用户操作不可恢复
- 建议定期备份数据库
- 数据库文件位置: `instance/statau.db`

### 3. 权限管理

- 只有 role 为 'admin' 的用户才能访问管理后台
- 普通用户尝试访问会返回 403 错误
- 未登录用户会返回 401 错误

### 4. 操作日志

- 当前版本暂未实现操作日志功能
- 建议在生产环境中添加操作日志记录

---

## 🔍 常见问题

### Q1: 忘记管理员密码怎么办?

**解决方案**: 重新运行初始化脚本

```bash
python init_admin.py
```

脚本会检测到管理员已存在,并重置密码为默认密码。

### Q2: 如何添加新的管理员?

**方法一**: 通过数据库直接修改

```python
from app import create_app
from extensions import db
from core.auth import User

app = create_app()
with app.app_context():
    user = User.query.filter_by(username='username').first()
    if user:
        user.role = 'admin'
        db.session.commit()
        print('用户已升级为管理员')
```

**方法二**: 修改 [`init_admin.py`](init_admin.py:1) 脚本添加多个管理员

### Q3: 管理后台入口在哪里?

**位置**:
1. 导航栏右侧（金色的"管理后台"链接）
2. 用户下拉菜单中
3. 直接访问: `http://localhost:5000/admin`

**注意**: 只有管理员登录后才能看到入口

### Q4: 如何查看数据库中的用户信息?

**方法一**: 使用管理后台（推荐）

访问 `http://localhost:5000/admin` 查看所有用户信息

**方法二**: 使用 SQLite 工具

```bash
# 使用 sqlite3 命令行工具
sqlite3 instance/statau.db

# 查询所有用户
SELECT * FROM users;

# 退出
.quit
```

**方法三**: 使用 Python 脚本

```python
from app import create_app
from core.auth import User

app = create_app()
with app.app_context():
    users = User.query.all()
    for user in users:
        print(f"ID: {user.id}, 用户名: {user.username}, 角色: {user.role}")
```

---

## 📝 开发建议

### 1. 扩展功能

可以考虑添加以下功能:

- 批量操作（批量删除、批量禁用）
- 用户详情页面
- 操作日志记录
- 数据导出功能
- 用户活动统计
- 邮件通知功能

### 2. 安全增强

- 添加操作日志
- 实现 IP 白名单
- 添加二次验证
- 实现会话超时
- 添加操作审计

### 3. 性能优化

- 添加缓存机制
- 优化数据库查询
- 实现异步操作
- 添加搜索索引

---

## 📞 技术支持

如有问题,请查看:
- 项目 README: [`README.md`](README.md:1)
- 架构文档: [`ARCHITECTURE.md`](ARCHITECTURE.md:1)
- 邮箱验证功能说明: [`邮箱验证功能说明.md`](邮箱验证功能说明.md:1)

---

**最后更新**: 2026-01-20
